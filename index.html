<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Halloween Vocabulary - Treasure Hunt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #1a1a2e; touch-action: none; }
        canvas { display: block; }
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: space-between; padding: 15px;
        }
        .hud-element {
            pointer-events: auto; background: #fff;
            color: #4b0082; padding: 8px 16px; border-radius: 12px;
            border: 3px solid #4b0082; box-shadow: 0 4px 0px #2e004f; font-weight: bold;
        }
        #feedback-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 4rem; font-weight: 900; opacity: 0; transition: opacity 0.3s;
            text-shadow: 4px 4px 0px #000; pointer-events: none; text-align: center;
        }
        #end-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(26, 26, 46, 0.95); display: none; flex-direction: column;
            align-items: center; justify-content: center; color: white; text-align: center;
        }
        .star { font-size: 3rem; color: #ffd700; margin: 0 5px; }
        .star-empty { font-size: 3rem; color: #444; margin: 0 5px; }
        #trophy { font-size: 6rem; display: none; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="flex justify-between items-start">
            <div class="hud-element" id="score-display">SCORE: 0 / 10</div>
            <button class="hud-element" onclick="location.reload()">üîÑ</button>
        </div>
        <div class="flex justify-center">
            <div class="hud-element text-2xl" id="target-word">CHARGE...</div>
        </div>
        <div id="touch-zones" class="grid grid-cols-3 gap-4 h-32 pointer-events-auto">
            <div onpointerdown="moveShip(-1)" onpointerup="stopShip()" class="bg-white/10 rounded-xl border-2 border-white/20 flex items-center justify-center text-3xl">‚¨ÖÔ∏è</div>
            <div></div>
            <div onpointerdown="moveShip(1)" onpointerup="stopShip()" class="bg-white/10 rounded-xl border-2 border-white/20 flex items-center justify-center text-3xl">‚û°Ô∏è</div>
        </div>
    </div>

    <div id="feedback-text">BRAVO!</div>

    <div id="end-screen">
        <div id="trophy">üèÜ</div>
        <h1 class="text-5xl font-black mb-4">TERMINE !</h1>
        <div id="stars-container" class="mb-6"></div>
        <p id="final-score" class="text-2xl mb-8"></p>
        <button onclick="location.reload()" class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-4 px-10 rounded-full text-xl shadow-lg transform active:scale-95 transition">REJOUER</button>
    </div>

    <script>
        const vocab = [
            { word: "GHOST", img: "ghost.png" },
            { word: "MONSTER", img: "monster.png" },
            { word: "MUMMY", img: "mummy.png" },
            { word: "PIRATE", img: "pirate.png" },
            { word: "PUMPKIN", img: "pumpkin.png" },
            { word: "SKELETON", img: "squeleton.png" },
            { word: "VAMPIRE", img: "vampire.png" },
            { word: "WITCH", img: "witch.png" }
        ];

        let scene, camera, renderer, ship, chests = [];
        let score = 0, currentQuestion = 0, gameActive = true;
        let targetItem = null, moveDir = 0, canHit = true;
        const loader = new THREE.TextureLoader();

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const ambient = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambient);

            // Cr√©ation du Joueur (Petit Bateau / Ghost Hunter)
            const shipGeo = new THREE.BoxGeometry(1.2, 0.5, 0.8);
            const shipMat = new THREE.MeshPhongMaterial({ color: 0xff4500 });
            ship = new THREE.Mesh(shipGeo, shipMat);
            ship.position.y = -3;
            scene.add(ship);

            camera.position.z = 5;
            spawnWave();
        }

        function spawnWave() {
            if (currentQuestion >= 10) { endGame(); return; }
            
            chests.forEach(c => scene.remove(c.mesh));
            chests = [];
            canHit = true;

            const indices = [...Array(vocab.length).keys()].sort(() => Math.random() - 0.5).slice(0, 3);
            const correctIdx = indices[Math.floor(Math.random() * 3)];
            targetItem = vocab[correctIdx];
            document.getElementById('target-word').innerText = "FIND: " + targetItem.word;

            indices.forEach((idx, i) => {
                const texture = loader.load(vocab[idx].img);
                const chestGeo = new THREE.PlaneGeometry(1.2, 1.2);
                const chestMat = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
                const mesh = new THREE.Mesh(chestGeo, chestMat);
                mesh.position.set((i - 1) * 2.2, 6, 0);
                scene.add(mesh);
                chests.push({ mesh, info: vocab[idx] });
            });
        }

        function moveShip(dir) { moveDir = dir; }
        function stopShip() { moveDir = 0; }

        function animate() {
            requestAnimationFrame(animate);
            if (!gameActive) return;

            if (moveDir !== 0) {
                ship.position.x = Math.max(-2.5, Math.min(2.5, ship.position.x + moveDir * 0.1));
            }

            chests.forEach(c => {
                c.mesh.position.y -= 0.04;
                if (canHit && c.mesh.position.distanceTo(ship.position) < 0.8) {
                    canHit = false;
                    const isCorrect = c.info.word === targetItem.word;
                    if(isCorrect) score++;
                    document.getElementById('score-display').innerText = `SCORE: ${score} / 10`;
                    handleHit(isCorrect);
                    chests.forEach(ch => ch.mesh.position.y = -500);
                    currentQuestion++;
                    setTimeout(spawnWave, 2000);
                }
                if (c.mesh.position.y < -5) spawnWave();
            });

            renderer.render(scene, camera);
        }

        function handleHit(isCorrect) {
            const ft = document.getElementById('feedback-text');
            ft.innerText = isCorrect ? "BRAVO! üéÉ" : "OUPS! üíÄ";
            ft.style.color = isCorrect ? "#ffcc00" : "#ff4d4d";
            ft.style.opacity = "1";
            setTimeout(() => ft.style.opacity = "0", 1500);
        }

        function endGame() {
            gameActive = false;
            document.getElementById('end-screen').style.display = 'flex';
            document.getElementById('final-score').innerText = `Ton score : ${score} / 10`;
            
            const starsContainer = document.getElementById('stars-container');
            let starsHTML = "";
            let starCount = 0;

            if (score >= 1) starCount = 1;
            if (score >= 5) starCount = 2;
            if (score >= 8) starCount = 3;

            for (let i = 1; i <= 3; i++) {
                starsHTML += i <= starCount ? '<span class="star">‚òÖ</span>' : '<span class="star-empty">‚òÖ</span>';
            }
            starsContainer.innerHTML = starsHTML;

            if (score === 10) {
                document.getElementById('trophy').style.display = 'block';
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ffcc00', '#ffffff', '#ff4500']
                });
            }
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>


